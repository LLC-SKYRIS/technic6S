# Блочное программирование

Блочное программирование позволяет составлять программы для дрона, используя наглядные функциональные блоки. Такой подход значительно упрощает работу с Technic. Не имея опыта в программировании, вы сможете из блоков построить задание, и выполнить это задание, запустив дрон. 

## Конфигурация

Для корректной работы работы блочного программирования аргумент `blocks` в launch-файле Technic (`~/technic_ws/src/technic/technic/launch/technic.launch`) должен быть в значении`true`:

```xml
<arg name="blocks" default="true"/>
```

## Запуск

Для того, чтобы открыть интерфейс блочного программирования в Tehcnic, [подключитесь к Technic по Wi-Fi](wifi.md) и перейдите на страницу http://10.42.0.1:8000/technic_blocks/ либо нажмите ссылку *Blocks programming* на [основной веб-странице Technic](wifi.md#веб-интерфейс).

Интерфейс выглядит следующим образом:


<img src="../assets/blocks-round-corners.png" width=400 class="center zoom">

Соберите необходимую программу из блоков в меню слева а затем нажмите кнопку *Run* для ее запуска. Также вы можете просмотреть сгенерированный код на языке Python, переключившись во вкладку *Python*.

Кнопка *Stop* позволяет остановить программу. Нажатие кнопки *Land* также останавливает программу и сажает дрон.

## Сохранение и загрузка

Для сохранения программы откройте меню справа сверху, выберите пункт меню *Save* и введите название программы. Название программы может содержать только латинские буквы, дефис, подчеркивание и точку. Все ранее сохраненные программы будут доступны в этом же меню.

На карте памяти сохраненные XML-файлы программ хранятся в каталоге `/technic_ws/src/technic/technic_blocks/programs/`.

В этом же меню доступны примеры программ (подкаталог `examples`).

## Блоки

Набор блоков приблизительно аналогичен набору ROS-сервисов [API автономных полетов Technic](simple_offboard.md). В этом разделе приведено описание некоторых из них.

Блоки Клевера поделены на 4 категории:

* <span style="padding:2px;color:white;background:#9d5ca6">Flight</span> – команды, имеющие отношение к полету.
* <span style="padding:2px;color:white;background:#ff9b00">State</span> – блоки, позволяющие получить те или иные параметры текущего состояния коптера.
* <span style="padding:2px;color:white;background:#01d754">LED</span> – блоки для управления [LED-лентой](leds.md).
* <span style="padding:2px;color:white;background:#5b97cc">GPIO</span> – блоки для работы с [GPIO-пинами](Программирование/Периферия/Исполнительная%20периферия/GPIO.md).

В остальных категориях находятся стандартные блоки Google Blockly.

### take_off

<img src="../assets/takeoff-round-corners.png" width=450 class="center zoom">

Взлететь на указанную высоту в метрах. Высота может быть произвольным блоком, возвращающим числовое значение.

Флаг `wait` определяет, должен ли дрон ожидать окончания взлета перед выполнением следующего блока.

### navigate

<img src="../assets/navigate-round-corners.png" width=350 class="center zoom">

Прилететь в заданную точку. Координаты точки задаются в метрах.

Флаг `wait` определяет, должен ли дрон ожидать завершения полета в точку перед выполнением следующего блока.

#### Поле *relative to* {#relative_to}

В блоке может быть выбрана [система координат](frames.md), в которой задана целевая точка:

* *body* – координаты относительно коптера: вперед (*forward*), влево (*left*), вверх (*up*).
* *markers map* – система координат, связанная с [картой ArUco-маркеров](aruco_map.md).
* *marker* – система координат, связанная с [ArUco-маркером](aruco_marker.md); появляется поле для ввода ID маркеа.
* *last navigate target* – координаты относительно последней заданной точки для навигации.
* *global* – глобальная система координат (широта и долгота) и относительная высота.
* *global, WGS 84 alt.* – глобальная система координат и высота в [системе WGS 84](https://ru.wikipedia.org/wiki/WGS_84).

### land

<img src="../assets/land-round-corners.png" width=350 class="center zoom">

Произвести посадку.

Флаг `wait` определяет, должен ли дрон ожидать окончания посадки перед выполнением следующего блока.

### wait

<img src="../assets/wait-round-corners.png" width=350 class="center zoom">

Ожидать заданное время в секундах. Время ожидания может быть произвольным блоком, возвращающим числовое значение.

### wait_arrival

<img src="../assets/waitarrival-round-corners.png" width=350 class="center zoom">

Ожидать, пока дрон долетит до целевой точки (заданной в [navigate](#navigate)-блоке).

### Работа с GPIO {#GPIO}

Категория <span style="padding:2px;color:white;background:#5b97cc">GPIO</span> содержит блоки для работы с GPIO. Обратите внимание, что для корректной работы этих блоков демон для работы с GPIO `pigpiod` должен быть включен:

```bash
sudo systemctl enable pigpiod.service
sudo systemctl start pigpiod.service
```

Более подробную информацию о GPIO читайте в [соответствующей статье](Программирование/Периферия/Исполнительная%20периферия/GPIO.md).

